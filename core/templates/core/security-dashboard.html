{% extends 'core/base.html' %}
{% load static %}

{% block title %}Security Team Dashboard | 2FA Project{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'core/css/security.css' %}">

<div class="security-dashboard">
    <aside class="sidebar">
        <div class="logo">
            <h2>Security Panel</h2>
        </div>
        <nav class="menu">
            <ul>
                <li><a href="#">Audit Logs</a></li>
                <li><a href="#">Monitor Compliance</a></li>
                <li><a href="#">Analyze Activities</a></li>
            </ul>
        </nav>
        <div class="profile-section">
            <hr>
            <div class="team-profile">
                <img src="{% static 'core/images/profile.png' %}" alt="Security Team" />
                <span>Security Team</span>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <section id="audit-logs" class="section">
            <h2>Audit Logs</h2>
            <div id="search">
                <input type="text" placeholder="Enter user name" name="search">
                <button>Search</button>
            </div>
            <table class="audit-logs-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Role</th>
                        <th>Details</th>
                        <th>Event Type</th>
                        <th>IP Address</th>
                        <th>Timestamp</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for log in logs %}
                    <tr>
                        <td>{{ log.user.get_full_name }}</td>
                        <td>{{ log.user.role|capfirst }}</td>
                        <td>{{ log.details }}</td>
                        <td>{{ log.event_type }}</td>
                        <td>{{ log.ip_address }}</td>
                        <td>{{ log.timestamp|date:"Y-m-d H:i" }}</td>
                        <td>
                        {% if log.user and log.user.id %}
                            {% if log.user.is_active %}
                            <form action="{% url 'block-user' log.user.id %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-block">Block</button>
                            </form>
                            {% else %}
                            <form action="{% url 'unblock-user' log.user.id %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-unblock">Unblock</button>
                            </form>
                            {% endif %}
                        {% else %}
                            <span style="color: red;">User not found</span>
                        {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7">No logs found.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </section>

        <section id="monitor-compliance" class="section" hidden>
            <h2>Compliance Monitor</h2>
            <p>Security compliance is currently at <strong>95%</strong>.</p>
            <ul>
                <li>ISO/IEC 27001: OK</li>
                <li>2FA Enforcement (Google Authenticator): OK</li>
                <li>Password Policy: Warning</li>
            </ul>
        </section>

        <section id="analyze-activities" class="section" hidden>
            <h2>Activity Analysis</h2>
            <p>Analyzing system usage and anomalies from past 7 days.</p>
            <ul>
                <li>Most active hour: 10:00 AM</li>
                <li>Unusual login attempt detected on 2025-07-02</li>
                <li>Failed logins: 5</li>
            </ul>
        </section>
    </main>
</div>

<script src="{% static 'core/js/security.js' %}"></script>
{% endblock %}
